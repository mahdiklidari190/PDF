<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>AI & ML - Ø§Ø±Ø§Ø¦Ù‡ Ù…Ù‡Ø¯ÛŒ Ú©Ù„ÛŒØ¯Ø±ÛŒ</title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700;900&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{
      --bg:#0a0a0f;
      --card:#121218;
      --accent:#00f2fe;
      --accent2:#6a11cb;
      --accent3:#ff006e;
      --text:#f0f0f0;
      --gray:#a0a0b0;
      --glass:#1a1a2480;
      --user-msg:#6a11cb;
      --bot-msg:#16213e;
      --success:#00d26a;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{width:100%;overflow-x:hidden;scroll-behavior:smooth}
    body{
      font-family:'Vazirmatn',sans-serif;
      background:linear-gradient(135deg,var(--bg),#1a1a2e,#16213e);
      background-attachment:fixed;
      color:var(--text);
      line-height:1.8;
      font-size:clamp(14px,1.2vw+1vh,18px);
    }
    .animated-bg{
      position:fixed;top:0;left:0;width:100%;height:100%;
      background:linear-gradient(45deg,var(--accent),var(--accent2),var(--accent3));
      background-size:400% 400%;
      animation:gradient 15s ease infinite;
      z-index:-2;opacity:.1;
    }
    @keyframes gradient{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    
    /* Ø¨Ù‡Ø¨ÙˆØ¯ Ø§Ø³ØªØ§ÛŒÙ„ Ú†Øª Ø¨Ø§Øª */
    .chatbot-float{
      position:fixed;bottom:2rem;left:2rem;z-index:3000;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      border:none;border-radius:50%;width:60px;height:60px;
      cursor:pointer;display:flex;align-items:center;justify-content:center;
      box-shadow:0 5px 25px rgba(0,242,254,.4);
      transition:transform .3s,box-shadow .3s;
    }
    .chatbot-float:hover{
      transform:scale(1.1) rotate(10deg);
      box-shadow:0 8px 35px rgba(0,242,254,.6);
    }
    .chatbot-float i{font-size:1.8rem;color:var(--bg)}
    .chatbot-container{
      position:fixed;bottom:2rem;left:2rem;z-index:3001;
      width:420px;height:650px;max-width:90vw;max-height:85vh;
      background:var(--glass);backdrop-filter:blur(20px);
      border:1px solid #ffffff1a;border-radius:20px;
      box-shadow:0 25px 70px #000000cc;
      display:flex;flex-direction:column;
      transform:scale(0) translateY(100px);
      opacity:0;
      transition:transform .4s cubic-bezier(0.4,0,0.2,1),opacity .3s;
      overflow:hidden;
    }
    .chatbot-container.active{
      transform:scale(1) translateY(0);
      opacity:1;
    }
    .chatbot-header{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      padding:1rem 1.5rem;display:flex;justify-content:space-between;align-items:center;
      color:var(--bg);font-weight:700;
    }
    .chatbot-body{
      flex:1;padding:1rem;overflow-y:auto;display:flex;flex-direction:column;gap:.8rem;
    }
    .chatbot-input-area{
      padding:1rem;border-top:1px solid #ffffff1a;display:flex;gap:.5rem;
      background:var(--card);
    }
    .chatbot-input{
      flex:1;background:transparent;border:1px solid #ffffff1a;border-radius:12px;
      padding:.8rem 1rem;color:var(--text);font-family:inherit;outline:none;
      transition:border-color .3s;
    }
    .chatbot-input:focus{border-color:var(--accent)}
    .chatbot-send{
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      border:none;border-radius:50%;width:45px;height:45px;
      cursor:pointer;display:flex;align-items:center;justify-content:center;
      color:var(--bg);font-size:1.2rem;transition:transform .2s;
    }
    .chatbot-send:hover{transform:scale(1.1)}
    .chatbot-send:disabled{opacity:.5;cursor:not-allowed}
    .message{
      padding:.8rem 1.2rem;border-radius:15px;max-width:85%;word-wrap:break-word;
      animation:messageSlide .3s ease-out;
      position:relative;
    }
    @keyframes messageSlide{
      from{opacity:0;transform:translateY(10px)}
      to{opacity:1;transform:translateY(0)}
    }
    .message.user{
      background:linear-gradient(135deg,var(--user-msg),var(--accent2));
      color:var(--text);align-self:flex-end;
      border-bottom-right-radius:5px;
    }
    .message.bot{
      background:var(--bot-msg);color:var(--text);
      align-self:flex-start;border-bottom-left-radius:5px;
    }
    .message-actions{
      position:absolute;top:5px;right:5px;opacity:0;
      transition:opacity .3s;display:flex;gap:3px;
    }
    .message:hover .message-actions{opacity:1}
    .copy-btn{
      background:rgba(255,255,255,.2);border:none;border-radius:4px;
      width:24px;height:24px;display:flex;align-items:center;justify-content:center;
      cursor:pointer;color:var(--text);font-size:.7rem;transition:all .2s;
    }
    .copy-btn:hover{background:var(--accent);color:var(--bg)}
    .copy-btn.copied{background:var(--success);color:var(--bg)}
    .typing-indicator{
      display:none;align-self:flex-start;background:var(--bot-msg);
      padding:.5rem 1rem;border-radius:15px;
    }
    .typing-indicator.active{display:flex;gap:.3rem;align-items:center}
    .typing-indicator span{
      width:8px;height:8px;background:var(--accent);border-radius:50%;
      animation:typingDot 1.4s infinite;
    }
    .typing-indicator span:nth-child(2){animation-delay:.2s}
    .typing-indicator span:nth-child(3){animation-delay:.4s}
    @keyframes typingDot{
      0%,60%,100%{transform:translateY(0)}
      30%{transform:translateY(-10px)}
    }
    .chatbot-close{
      background:none;border:none;color:var(--bg);font-size:1.5rem;
      cursor:pointer;transition:transform .2s;
    }
    .chatbot-close:hover{transform:rotate(90deg)}
    .message-time{
      font-size:.7rem;color:var(--gray);margin-top:.3rem;text-align:left;
    }
    .chatbot-welcome{
      background:linear-gradient(135deg,var(--accent)30%,var(--accent2)70%);
      padding:.5rem 1rem;border-radius:10px;margin-bottom:.5rem;
      font-size:.85rem;color:var(--bg);font-weight:500;
    }
    .chatbot-stats{
      display:flex;justify-content:space-between;align-items:center;
      padding:.3rem .5rem;font-size:.75rem;color:var(--gray);
      border-top:1px solid #ffffff1a;
    }
    .chatbot-learning-mode{
      display:flex;align-items:center;gap:.3rem;
      color:var(--accent);font-weight:500;
    }
    .chatbot-suggestion{
      display:inline-block;background:var(--card);border:1px solid var(--accent);
      padding:.2rem .6rem;border-radius:12px;margin:.2rem;font-size:.75rem;
      cursor:pointer;transition:all .2s;
    }
    .chatbot-suggestion:hover{
      background:var(--accent);color:var(--bg);transform:translateY(-2px);
    }
    .chatbot-error{
      background:rgba(255,0,110,.2);border:1px solid var(--accent3);
      padding:.5rem;border-radius:8px;margin:.5rem 0;font-size:.8rem;
    }
    .connection-status{
      display:flex;align-items:center;gap:.3rem;font-size:.7rem;
    }
    .status-dot{
      width:8px;height:8px;border-radius:50%;background:var(--accent3);
      animation:pulse 2s infinite;
    }
    .status-dot.connected{background:var(--success)}
    @keyframes pulse{
      0%,100%{opacity:1}
      50%{opacity:.5}
    }
    @media(max-width:768px){
      .chatbot-container{width:100%;height:100%;max-width:100%;max-height:100%;bottom:0;left:0;border-radius:0}
      .chatbot-container.active{transform:scale(1) translateY(0)}
    }
  </style>
</head>
<body>

<div class="animated-bg"></div>

<!-- Ø³Ø§ÛŒØ± Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ HTML Ø´Ù…Ø§ Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ± Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ù†Ø¯ -->
<!-- ÙÙ‚Ø· Ú†Øª Ø¨Ø§Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª -->

<!-- Floating Chat Button -->
<button class="chatbot-float" id="chatbotFloat">
  <i class="fas fa-robot"></i>
</button>

<!-- Chatbot Container -->
<div class="chatbot-container" id="chatbotContainer">
  <div class="chatbot-header">
    <div style="display:flex;align-items:center;gap:.5rem">
      <i class="fas fa-robot"></i> 
      <span>Ù…Ø±Ø¨ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ - Ù†Ø³Ø®Ù‡ Cohere API</span>
    </div>
    <button class="chatbot-close" id="chatbotClose"><i class="fas fa-times"></i></button>
  </div>
  <div class="chatbot-body" id="chatbotBody">
    <div class="chatbot-welcome">
      ğŸ‘‹ Ù…Ù† Ù…Ø±Ø¨ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø´Ù…Ø§ Ù‡Ø³ØªÙ…! 
      <div style="font-size:.75rem;margin-top:.2rem">
        Ø¨Ø§ Cohere AI Ù…Ø³ØªÙ‚ÛŒÙ…Ø§Ù‹ Ø§Ø±ØªØ¨Ø§Ø· Ø¯Ø§Ø±Ù…. Ù‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ø¨Ù¾Ø±Ø³!
      </div>
    </div>
    <div class="message bot">
      <div class="message-actions">
        <button class="copy-btn" title="Ú©Ù¾ÛŒ Ù¾ÛŒØ§Ù…"><i class="fas fa-copy"></i></button>
      </div>
      ğŸ¤– Ø³Ù„Ø§Ù…! Ù…Ù† Ø¨Ù‡ Cohere AI Ù…ØªØµÙ„ Ù‡Ø³ØªÙ… Ùˆ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾Ø§Ø³Ø®Ú¯ÙˆÛŒÛŒ Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ø´Ù…Ø§.
      <div style="margin-top:.5rem;font-size:.85rem">
        Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¯Ø± Ù…ÙˆØ±Ø¯ AIØŒ MLØŒ Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§ØŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ùˆ... Ú©Ù…Ú© Ú©Ù†Ù…!
        <div style="margin-top:.3rem">
          <span class="chatbot-suggestion" onclick="insertSuggestion('ØªØ§Ø±ÛŒØ®Ú†Ù‡ AI')">ØªØ§Ø±ÛŒØ®Ú†Ù‡ AI</span>
          <span class="chatbot-suggestion" onclick="insertSuggestion('ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ† Ú†ÛŒØ³ØªØŸ')">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ†</span>
          <span class="chatbot-suggestion" onclick="insertSuggestion('Ú©Ø§Ø±Ø¨Ø±Ø¯ Ù¾Ø²Ø´Ú©ÛŒ AI')">Ú©Ø§Ø±Ø¨Ø±Ø¯ Ù¾Ø²Ø´Ú©ÛŒ</span>
        </div>
      </div>
      <div class="message-time">Ø­Ø§Ù„Ø§</div>
    </div>
  </div>
  <div class="typing-indicator" id="typingIndicator">
    <span></span><span></span><span></span>
  </div>
  <div class="chatbot-input-area">
    <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Ù‡Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒ Ø¨Ù¾Ø±Ø³... (Ù…Ø«Ø§Ù„: Ú†Ø·ÙˆØ± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ† Ø´Ø±ÙˆØ¹ Ú©Ù†Ù…ØŸ)">
    <button class="chatbot-send" id="chatbotSend"><i class="fas fa-paper-plane"></i></button>
  </div>
  <div class="chatbot-stats">
    <div class="chatbot-learning-mode">
      <i class="fas fa-book-open"></i>
      <span>Ø­Ø§Ù„Øª Ø¢Ù…ÙˆØ²Ø´ÛŒ ÙØ¹Ø§Ù„</span>
    </div>
    <div class="connection-status">
      <span class="status-dot connected" id="statusDot"></span>
      <span id="connectionStatus">Ù…ØªØµÙ„</span>
    </div>
    <div id="questionCounter">â“ Û° Ø³ÙˆØ§Ù„</div>
  </div>
</div>

<!-- Ø³Ø§ÛŒØ± Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ HTML Ø´Ù…Ø§ -->

<script>
  // âš ï¸ Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ: Ø§ÛŒÙ† Ú©Ù„ÛŒØ¯ API Ø¯Ø± Ú©Ø¯ Ú©Ù„Ø§ÛŒÙ†Øª Ù‚Ø±Ø§Ø± Ø¯Ø§Ø±Ø¯ Ùˆ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ù…Ù†Ø§Ø³Ø¨ Ø§Ø³Øª.
  // Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒØŒ Ø­ØªÙ…Ø§Ù‹ Ø§Ø² ÛŒÚ© backend Ø³Ø±ÙˆØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.
  const API_KEY = 'qMW8g9viT3CbCDnkgOHfXWlTW6L7DBc5pr6J0NC4';
  const API_URL = 'https://api.cohere.ai/v1/chat';
  const MODEL = 'c4ai-aya-expanse-32b';

  // Chatbot functionality
  const chatbotFloat = document.getElementById('chatbotFloat');
  const chatbotContainer = document.getElementById('chatbotContainer');
  const chatbotClose = document.getElementById('chatbotClose');
  const chatbotBody = document.getElementById('chatbotBody');
  const chatbotInput = document.getElementById('chatbotInput');
  const chatbotSend = document.getElementById('chatbotSend');
  const typingIndicator = document.getElementById('typingIndicator');
  const questionCounter = document.getElementById('questionCounter');
  const statusDot = document.getElementById('statusDot');
  const connectionStatus = document.getElementById('connectionStatus');

  let questionCount = 0;
  let isConnected = true;

  chatbotFloat.addEventListener('click', () => {
    chatbotContainer.classList.add('active');
  });

  chatbotClose.addEventListener('click', () => {
    chatbotContainer.classList.remove('active');
  });

  function insertSuggestion(text) {
    chatbotInput.value = text;
    chatbotInput.focus();
    sendMessage();
  }

  function updateCounter() {
    questionCounter.textContent = `â“ ${questionCount} Ø³ÙˆØ§Ù„`;
  }

  function updateConnectionStatus(connected) {
    isConnected = connected;
    if (connected) {
      statusDot.className = 'status-dot connected';
      connectionStatus.textContent = 'Ù…ØªØµÙ„';
    } else {
      statusDot.className = 'status-dot';
      connectionStatus.textContent = 'Ù‚Ø·Ø¹';
    }
  }

  function addMessage(content, isUser = false) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
    
    messageDiv.innerHTML = `
      <div class="message-actions">
        <button class="copy-btn" title="Ú©Ù¾ÛŒ Ù¾ÛŒØ§Ù…"><i class="fas fa-copy"></i></button>
      </div>
      ${content}
      <div class="message-time">${new Date().toLocaleTimeString('fa-IR', { hour: '2-digit', minute: '2-digit' })}</div>
    `;
    
    chatbotBody.appendChild(messageDiv);
    
    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† event listener Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ú©Ù¾ÛŒ
    const copyBtn = messageDiv.querySelector('.copy-btn');
    copyBtn.addEventListener('click', () => {
      const messageText = messageDiv.innerText.replace('Ú©Ù¾ÛŒ Ù¾ÛŒØ§Ù…', '').replace(/\d{1,2}:\d{2}\s*(Ø¨.Ø¸|Ù‚.Ø¸)?/g, '').trim();
      copyToClipboard(messageText);
      
      // Ø§ÙÚ©Øª Ú©Ù¾ÛŒ Ù…ÙˆÙÙ‚
      copyBtn.innerHTML = '<i class="fas fa-check"></i>';
      copyBtn.classList.add('copied');
      
      setTimeout(() => {
        copyBtn.innerHTML = '<i class="fas fa-copy"></i>';
        copyBtn.classList.remove('copied');
      }, 2000);
    });
    
    chatbotBody.scrollTop = chatbotBody.scrollHeight;
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      console.log('Ù¾ÛŒØ§Ù… Ú©Ù¾ÛŒ Ø´Ø¯');
    }).catch(err => {
      console.error('Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ:', err);
      // Ø±ÙˆØ´ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø±Ø§ÛŒ Ù…Ø±ÙˆØ±Ú¯Ø±Ù‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
    });
  }

  function showTypingIndicator() {
    typingIndicator.classList.add('active');
  }

  function hideTypingIndicator() {
    typingIndicator.classList.remove('active');
  }

  async function sendMessage() {
    const message = chatbotInput.value.trim();
    if (!message) return;

    addMessage(message, true);
    chatbotInput.value = '';
    chatbotSend.disabled = true;
    showTypingIndicator();

    questionCount++;
    updateCounter();

    try {
      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${API_KEY}`,
          'Content-Type': 'application/json',
          'Accept': 'application/json'
        },
        body: JSON.stringify({
          model: MODEL,
          message: message,
          stream: false
        })
      });

      if (!response.ok) {
        // Ø¨Ø±Ø±Ø³ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
        if (response.status === 401) {
          throw new Error('Ú©Ù„ÛŒØ¯ API Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
        } else if (response.status === 429) {
          throw new Error('Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¯Ø±Ø®ÙˆØ§Ø³Øª - Ù„Ø·ÙØ§Ù‹ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ù†ÛŒØ¯');
        } else if (response.status >= 500) {
          throw new Error('Ù…Ø´Ú©Ù„ Ø¯Ø± Ø³Ø±ÙˆØ± - Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯');
        } else {
          throw new Error(`Ø®Ø·Ø§ÛŒ HTTP! ÙˆØ¶Ø¹ÛŒØª: ${response.status}`);
        }
      }

      const data = await response.json();
      
      if (data.text) {
        updateConnectionStatus(true);
        addMessage(data.text.replace(/\n/g, '<br>'), false);
      } else {
        throw new Error('Ù¾Ø§Ø³Ø®ÛŒ Ø§Ø² Ø³Ø±ÙˆÛŒØ³ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯');
      }

    } catch (error) {
      console.error('Error:', error);
      updateConnectionStatus(false);
      
      let errorMessage = 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Cohere API. ';
      
      if (error.message.includes('Failed to fetch')) {
        errorMessage += 'Ù…Ø´Ú©Ù„ Ø´Ø¨Ú©Ù‡ ÛŒØ§ CORS. ';
      } else if (error.message.includes('API')) {
        errorMessage += error.message;
      }
      
      errorMessage += 'Ù„Ø·ÙØ§Ù‹ Ø¨Ø¹Ø¯Ø§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø§Ù…ØªØ­Ø§Ù† Ú©Ù†ÛŒØ¯.';
      
      addMessage(`âŒ ${errorMessage}`, false);
    } finally {
      hideTypingIndicator();
      chatbotSend.disabled = false;
      chatbotInput.focus();
    }
  }

  chatbotSend.addEventListener('click', sendMessage);

  chatbotInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendMessage();
    }
  });

  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† suggestionÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
  window.insertSuggestion = insertSuggestion;

  // Counter initialization
  updateCounter();
  updateConnectionStatus(true);
</script>

</body>
</html>
